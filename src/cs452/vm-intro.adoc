= The Abstraction: Address Spaces
include::../../includes/attributes-settings.adoc[]

== Early Systems

* OS was a set of routines (a library) that sat in memory at address 0
* One running program
* Systems were simple!

=== Layout

image::images/vm-early-os.png[early os,width=400px]

== Multiprogramming and Time Sharing

* Multiple processes were ready to run at a given time
* Multiple people sharing one system
* Time sharing the hardware
* Systems became interactive!

=== Layout

image::images/time-sharing.png[time share,width=400px]

== The Address Space

image::images/modern-address-space.png[Address space,width=400px]

== Virtualize Memory

* The OS must virtualize the memory
* All process can't start at 0!
* But all process think they do?

== Memory Quiz

In class exercise! For all the following slides
you will be shown a snippet of code and will need to
determine where the variable lives.

* Data
* Heap
* Stack

=== Length

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== A

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== bar (in foo)

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== bar (in main)

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== bar[0]

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== argc

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

=== *A (dereference A)

[,c,linenums]
----
int *A;
void foo(int* bar, int len){
    A = malloc(sizeof(int)*len);
    /*...some code*/
}

void main(int argc, char **argv){
    int length =10; int i; int bar[length];
    foo(&bar[0], length);
    /*...some code*/
    free(A);
}
----

* Data
* Heap
* Stack

== Questions
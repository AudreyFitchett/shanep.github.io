= Visual Studio Code Tips and Tricks
include::../../includes/attributes-settings.adoc[]


This document will walk you through doing development using VSCode and introduce
you to some cool tips and tricks. You can install VSCode on your personal
machine, or you can use VSCode in the cloud with
https://github.com/features/codespaces[GitHub Codespaces].


== Install VSCode

You can install VSCode and all the required tools on your personal (local)
machine. The advantages of using a local install is it is 100% free and you
don't need an internet connection to do your work. The disadvantage is it can
sometimes be difficult and time consuming to install and configure all the tools
correctly especially if you are using the Windows operating system.

. https://git-scm.com/downloads[Install Git]
. https://code.visualstudio.com/learntocode/[Install Visual Studio Code (Java)]
. Read through the https://code.visualstudio.com/docs/getstarted/userinterface[User interface tutorial]
. https://code.visualstudio.com/docs/terminal/basics[Read Terminal Basics]
. Complete all the steps in the <<First time configuration>> section of this document.

== First time configuration

Before we start using VSCode we need to set a few basic configurations. Each
section is clearly labeled with what Operating system it applies to. You need to
follow these steps on both local and remote setups.

=== Configure defaults

IMPORTANT: This section must be completed on ALL operating systems.

The last step before beginning to write code is to configure the user tags that will
be stored as metadata on each commit for your development environment.  To do
this, open VSCode then click View in the top menu and select Terminal. Enter the
following commands in the terminal, using your name and email address

```bash
git config --global user.name "Your Name"
git config --global user.email "you@example.com"
```

When you are first learning to use git using a rebase workflow can help to
reduce the number of conflicts that you have to deal with. Thus, we will set
it as the default method when pulling down code.

```bash
git config --global pull.rebase true
git config --global fetch.prune true
git config --global diff.colorMoved zebra
```

Additional reading:

* https://www.atlassian.com/git/tutorials/merging-vs-rebasing[Merging vs. Rebasing]
* https://spin.atomicobject.com/2020/05/05/git-configurations-default/[Git configurations]

=== Configure the default terminal (Windows Only)

IMPORTANT: This section only applies to Windows users who are developing
locally. If "Git Bash" is not listed as an option you need to
https://git-scm.com/downloads[install Git] as detailed in the first section of
this document.

VSCode defaults to powershell on Windows. While powershell is a great terminal
all the scripts in my classes require Git Bash. So it is best to set the default
terminal to Git Bash so everything works correctly

. Open Visual Studio Code
. Press CTRL + SHIFT + P to open the Command Palette
. Search for “Terminal: Select Default Profile”
. Select "Git Bash"

image::../images/teaching/vscode-default-terminal.png[Set Default Terminal]

== Developing Remotely

IMPORTANT: This section is optional and is provided for students who wish to
develop remotely. You are not required to develop remotely, all the homework
assignments can be done on the CS lab machines in person.

This section will walk you through using VSCode to develop remotely. This is
incredibly convenient as it allows you to connect directly to a server to run and
test your code. For advanced users you can read through the
https://code.visualstudio.com/docs/remote/ssh[official documentation] for more
details on how everything works.



=== Connecting to a Server

* First you need to install the https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack[Remote development extension pack]
* Open the https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette[command pallet]
* Select _Remote-SSH: Connect to Host..._ from the Command Palette (F1) and connect to _username@servername.com_
** VSCode will save your information so when you connect again you will just select the server from the list!
* Select connect to started developing
** *NOTE:* The first time you connect it may take some time for VSCode to
install all the tools so be patient and don't close or stop the process or it
could cause your install to fail!

image::../images/teaching/vscode_remote_devel.gif[Visual walk through]

=== Verify your connection

Once you are connected you can verify your status as shown below:

. You should see SSH: onyx.boisestate.edu
. When you run the command _hostname_ in the integrated terminal you should see
  onyx.boisestate.edu
. When you run the command _whoami_ in the integrated terminal you should see
  your Boise State username.

image::../images/teaching/vscode_connected.png[VSCode connected]

=== Installing remote extensions

When you are working remote VSCode does not automatically install any of your extensions. To get
all your remote extensions installed open the https://code.visualstudio.com/docs/editor/extension-gallery[Extension manager]
and then select the local extensions that you wish to install on the remote machine.

image::../images/teaching/vscode-remote-extensions.png[VSCode remote extensions]

== Developing in the Cloud (GitHub Codespaces)

IMPORTANT: This section is not required for all classes. Please check your class
syllabus to see if developing in the cloud is required. If using codespaces is
not required in your class you can skip this section. You still need to complete
all the steps in the <<First time configuration>> section of this document after
you start your Codespace.

https://github.com/features/codespaces[GitHub Codespaces] is a complete VSCode
development environment in the cloud. It is the quickest and easiest way to
write code on any machine that has an internet connection and web browser.
GitHub Codespaces provides a free tier (60 hours) that should be enough cover
all the usage for a student working on homework. However, you still may need to
pay a small fee depending on how much you use the service over the course of a
semester.

* https://docs.github.com/en/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces[Codespaces Billing]
* https://docs.github.com/en/codespaces[Codespaces Documentation]

video::_W9B7qc9lVc[youtube, width="560", height="315"]

=== Starting a Codespace

Every repository will need its own Codespace. Creating a Codespace is fairly
straight forward after you have cloned your repository simply click the **code
button** and then click the **Create Codespaces** as shown below. This will launch
a Codespace that you can use to work on your project.

image::../images/teaching/start-codespaces.gif[start codespaces]

=== Configuring Codespace

When you are working remote VSCode does not automatically install any of your
extensions. To get all your remote extensions installed open the
https://code.visualstudio.com/docs/editor/extension-gallery[Extension manager]
and then select the local extensions that you wish to install on the remote
machine. The first extension that you should install is Live Preview as shown
below.

image::../images/teaching/vscode-live-preview.png[VSCode Live preview]

=== Remote Website Development

As long as you are using the
https://code.visualstudio.com/docs/editor/integrated-terminal[integrated
terminal] in VSCode you can launch a website that you built on the server and
VSCode will automatically forward the ports for you so you can view it locally.
For simple websites that don't need to run a web server you can use the Live
preview feature. After you have installed the VScode Live preview extension you
can start the built in web server just as you would when developing locally.

WARNING: Sometimes you will see an error when trying to view your website
(shown below). This is because there is sometimes a delay on how fast Codespaces
sets up port forwarding. If you click the "Open in Browser" popup it should open
up a new tab showing you your website.

image::../images/teaching/vscode-live-preview-problems.png[VSCode Live preview problems]

=== Running a Web Server

For more complicated setups like when you want to run a PHP server server from
Nodejs, you can start the server just like you normally would and then view you
website from the ports tab show below.

image::../images/teaching/vscode-port-forward.gif[VSCode connected]

=== Accessing the menu in Codespaces

For the most part using Codespaces is identical to developing remotely. One of
the biggest differences is accessing the Menu toolbar. The screenshot below
shows you how to access the toolbar in Codespaces.

image::../images/teaching/codespaces-tool-bar.png[codespaces toolbar]

=== Accessing all my Codespaces

You can access all the Codespaces you created from your main profile page. Click
on the **Codespaces** menu option as shown below.

image::../images/teaching/all-codespaces.png[All Codespaces]

Then you should see all the Codespaces that you have created and can use!

image::../images/teaching/all-codespaces-view.png[All Codespaces view]

=== Codespaces Set default timeout

The default idle timeout for codespaces is 30 minutes. You can quickly burn
through all your free hours if you keep this default. I recommend that you set
the default timeout to 10 minutes to preserve your free tier time.

image::../images/teaching/github-settings.png[Github settings]

image::../images/teaching/github-settings-codespaces.png[Github settings codespaces]

image::../images/teaching/github-settings-codespaces-default-idle.png[Github settings idle]

== Debugging Pointers

In the C programming language we can allocate a chunk of memory on the heap and treat that
chunk of memory as an array. If you are working on debugging a problem and want to inspect the
contents of the array using the GUI debugger interface in VSCode you may have to tell the
debugger (with a cast) that a pointer is actually pointing to a dynamically allocated array not a
single variable. This example walks through how to display a pointer as an array that is
embedded within a struct.

More reading about C and GDB.

* http://unixwiz.net/techtips/reading-cdecl.html[Reading C Declarations]
* https://sourceware.org/gdb/current/onlinedocs/gdb/Arrays.html[GDB Artificial Arrays]
* http://lldb.llvm.org/use/map.html[GDB to LLDB usage]
* https://code.visualstudio.com/docs/editor/debugging#_data-inspection[VSCode Data inspection]

=== Dynamic array of structs

Consider the struct declaration `buddy_pool` shown below. The `avail` member is a pointer
that we must dynamically allocate and want to display in the debugger as an array.
We can allocate the a `buddy_pool` struct (in the stack or data segment) and then
dynamically allocate the `avail` array using `malloc`.

[,c]
----
struct avail
{
    int tag;
    int kval;
    struct avail *next;
    struct avail *prev;
}

struct buddy_pool
{
    size_t kval_m;
    uintptr_t base;
    struct avail *avail; /*pointer to the start of the avail array*/
};

struct buddy_pool pool;
pool.kval = 9;
pool.base = 0;
pool.avail = malloc(sizeof(struct avail) * 9);
----

If we run the debugger we will see the variable `pool` with the element `avail` is displayed as a
single variable not an array of 9 structs as we expected.

image::../images/teaching/pointer_as_array_bad.png[Pointer not showing the full array]

The element `avail` is just a pointer to the memory address of element 0. The debugger can't
determine the size of the array and thus will display it as a single struct instead of an
array as expected.

=== Cast the array

Fortunately, all is not lost! Most debuggers allow you to set a watch on a memory location and you
can force the debugger to cast the memory to a certain type. Both gdb and lldb have specific commands
to display a memory block as an array. However, using casting works regardless of what debugger
you are using.

If we add a new https://code.visualstudio.com/docs/editor/debugging#_data-inspection[watch]
on a variable and then force the debugger to display the memory block as an array instead of a
single variable we can easily inspect the data and track down any issues you are experiencing.

[,c]
----
(struct avail(*) [9])pool->avail
----

image::../images/teaching/setting_watch_vscode.gif[Watch var showing the full array]

=== Dynamic Array

For a plain old dynamic array you can add a watch expression that is set to
to the desired type.

[,c]
----
*(int(*)[10])A
----


